CREATE SCHEMA `store` ;


CREATE TABLE PERMISSION (
  id INT(10) PRIMARY KEY NOT NULL AUTO_INCREMENT,
  description varchar(255) NOT NULL
);

INSERT INTO PERMISSION (ID,DESCRIPTION) VALUES (1,'Admin');
INSERT INTO PERMISSION (ID,DESCRIPTION) VALUES (2,'User');

CREATE TABLE USER (
  ID INT(10) PRIMARY KEY NOT NULL AUTO_INCREMENT,
  account_non_expired bit(1) DEFAULT NULL,
  account_non_locked bit(1) DEFAULT NULL,
  credentials_non_expired bit(1) DEFAULT NULL,
  date datetime(6) NOT NULL,
  enabled bit(1) DEFAULT NULL,
  full_name varchar(255) DEFAULT NULL,
  password varchar(255) DEFAULT NULL,
  user_name varchar(255) DEFAULT NULL,
  UNIQUE KEY UK_USER_NAME (user_name)
);

CREATE TABLE USER_PERMISSION 
(
   ID_USER INT(10) NOT NULL,
   ID_PERMISSION INT(10) NOT NULL,
   CONSTRAINT USER_PERMISSION FOREIGN KEY (ID_USER) REFERENCES USER (ID),
   CONSTRAINT PERMISSION_USER FOREIGN KEY (ID_PERMISSION) REFERENCES PERMISSION (ID)
);


CREATE TABLE PRODUCT_TYPE 
(
	ID INT(10) PRIMARY KEY NOT NULL AUTO_INCREMENT,
	DESCRIPTION VARCHAR(10),
	CONSTRAINT CHK_DESCRIPTION CHECK (DESCRIPTION = 'Fruit' or DESCRIPTION = 'Vegetable')
);

INSERT INTO PRODUCT_TYPE (DESCRIPTION) VALUES ('Fruit');
INSERT INTO PRODUCT_TYPE (DESCRIPTION) VALUES ('Vegetable');

CREATE TABLE PRODUCT 
(
	ID INT(10) PRIMARY KEY NOT NULL AUTO_INCREMENT,
    NAME VARCHAR(150) NOT NULL,
    QUANTITY INT(10) NOT NULL,
    ID_PRODUCT_TYPE INT(10) NOT NULL,
    CONSTRAINT PRODUCT_PRODUCT_TYPE FOREIGN KEY (ID_PRODUCT_TYPE) 
    REFERENCES PRODUCT_TYPE (ID)
);


CREATE TABLE SELL 
(
	ID INT(10) PRIMARY KEY NOT NULL AUTO_INCREMENT,
	VALUE DOUBLE NOT NULL,
	DATE_SELL TIMESTAMP
)


CREATE TABLE SELL_PRODUCT 
(
	ID INT(10) PRIMARY KEY NOT NULL AUTO_INCREMENT,
	QUANTITY INT(10) NOT NULL,
	ID_SELL INT(10) NOT NULL,
	ID_PRODUCT INT(10) NOT NULL,
	CONSTRAINT SELL_PRODUCT FOREIGN KEY (ID_SELL) 
    REFERENCES SELL (ID),
    CONSTRAINT PRODUCT_SELL FOREIGN KEY (ID_PRODUCT) 
    REFERENCES PRODUCT (ID)
);